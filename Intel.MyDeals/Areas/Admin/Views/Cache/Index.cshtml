@{
    Layout = "~/Views/Shared/_LayoutAngular.cshtml";
}

@Styles.Render("~/css/_cache.css")
@Scripts.Render("~/js/_cache.js")

<div style="padding: 0 20px; width: 100%;">

    <h1>Cache Manager</h1>
    <p style="font-size: 10px;">
        The Cache Manager will show which cache containers are loaded and display their count.
        You can clear the cache, reload the cache or even view the cache contents.
    </p>

    <div id="cacheContainer">
 
        <div ng-controller="CacheCtrl" ng-init="loadCache()">

            <div class="cacheList fl">
                <h5>Cache Status</h5>
                <table id="tblCache">
                    <tr>
                        <th style="text-align: left;">Cache Name</th>
                        <th style="text-align: right;">Count</th>
                        <th style="text-align: center;" colspan="3">Action</th>
                        <th style="width: 25px;">&nbsp;</th>
                    </tr>
                    <tr ng-repeat="data in cacheData">
                        <td>{{data.CacheName}}</td>
                        <td style="text-align: right;">{{data.CacheCount}}</td>
                        <td><div class="iconLink" ng-click="loadCacheByName(data)" title="Load Cache"><i class="fa fa-upload" aria-hidden="true"></i></div></td>
                        <td><div class="iconLink" ng-click="clearCacheByName(data)" title="Clear Cache"><i class="fa fa-trash-o" aria-hidden="true"></i></div></td>
                        <td><div class="iconLink" ng-click="viewCacheByName(data)" title="View Cache"><i class="fa fa-code" aria-hidden="true"></i></div></td>
                        <td ng-show="data.loading"><i class="fa fa-spinner fa-pulse fa fa-fw"></i></td>
                    </tr>
                </table>
                <div style="margin-top: 15px; text-align: center;">
                    <button ng-click="clearAll()" class="k-primary">Clear All</button>
                    <button ng-click="reloadAll()" class="k-primary">Reload All Cache</button>
                </div>
            </div>

            <div class="fl">
                <div id="viewResultsContainer" resizable ng-style="{ width: windowWidth, height: windowHeight; }">
                    <h5>Cache Contents <span style="font-size: 12px;" id="cName"></span></h5>
                    <div id="viewResults">{{currentCacheDetails}}</div>
                </div>
            </div>

            <div class="clearBoth"></div>

        </div>

    </div>
</div>


<script type="text/x-kendo-tmpl" id="cache-status-template">
    <div class="cacheList fl">
        <h5>Cache Status</h5>
        <table id="tblCache">
            <tr>
                <th style="text-align: left;">Cache Name</th>
                <th style="text-align: right;">Count</th>
                <th style="text-align: center;" colspan="3">Action</th>
                <th style="width: 25px;">&nbsp;</th>
            </tr>
            # for (var i = 0; i < data.length; i++) { #
            <tr>
                <td>#= data[i].CacheName #</td>
                <td style="text-align: right;">#= data[i].CacheCount #</td>
                <td><a href="javascript:cache.LoadCacheByName('#= data[i].CacheName #')" title="Load Cache"><i class="fa fa-upload" aria-hidden="true"></i></a></td>
                <td><a href="javascript:cache.ClearCacheByName('#= data[i].CacheName #')" title="Clear Cache"><i class="fa fa-trash-o" aria-hidden="true"></i></a></td>
                <td><a href="javascript:cache.ViewCache('#= data[i].CacheName #')" title="View Cache"><i class="fa fa-code" aria-hidden="true"></i></a></td>
                <td id="anim_#= data[i].CacheName #" style="display: none;"><i class="fa fa-spinner fa-pulse fa fa-fw"></i></td>
            </tr>
            # } #
        </table>
        <div style="margin-top: 15px; text-align: center;">
            <button id="btnClearAll" class="k-primary">Clear All</button>
            <button id="btnReload" class="k-primary">Reload All Cache</button>
        </div>
    </div>
    
    <div class="fl">
        <div id="viewResultsContainer" style="display: none;">
            <h5>Cache Contents <span style="font-size: 12px;" id="cName"></span></h5>
            <div id="viewResults"></div>
        </div>
    </div>

    <div class="clearBoth"></div>
</script>

<script>
    // Handle resize
    //$(window).resize(function () {
    //    cache.resizeContent();
    //});

    //$(document).ready(function () {
    //    window.setTimeout(function () {
    //        cache.resizeContent();
    //        cache.LoadCacheStatus();
    //    }, 100);
    //});
</script>

