@using System
@using System
@using System
@using System.Collections.Generic
@using Intel.MyDeals.Entities
@using Intel.Opaque
@using Intel.MyDeals.App
@{
    var usrName = "UNKNOWN";
    var usrWwid = 0;
    var usrRole = "UNKNOWN";
    var usrRoleExtension = "";
    var usrRoleId = 0;
    var usrEmail = "";
    var usrVerticals = "";
    var isEditableGrid = true;
    var appVer = "UNKNOWN";
    try
    {
        usrName = ViewBag.UserToken.Usr.FirstName + " " + ViewBag.UserToken.Usr.LastName;
        usrWwid = ViewBag.UserToken.Usr.WWID;
        usrEmail = ViewBag.UserToken.Usr.Email;
        usrRole = ViewBag.UserToken.Role.RoleTypeCd;
        usrRoleId = ViewBag.UserToken.Role.RoleTypeId;
        appVer = ViewBag.AppVer;

        foreach (var x in ViewBag.UserVarticals)
        {
            usrVerticals += "," + x.VerticalName;
        }
        if (usrVerticals.Length >= 1)
        {
            usrVerticals = usrVerticals.Remove(0, 1);
        }
    }
    catch (Exception ex)
    {
        OpLogPerf.Log(ex);
    }

    OpUserToken opUserToken = (OpUserToken)ViewBag.UserToken;

    string extraUserPrivs = "";
    string superPrefix = "";
    List<string> extraUserPrivsDetail = new List<string>();
    bool isDeveloper = opUserToken.IsDeveloper();
    bool isReportingUser = opUserToken.IsReportingUser();
    bool isTester = opUserToken.IsTester();
    bool isSuper = opUserToken.IsSuper();
    bool isCustomerAdmin = opUserToken.IsCustomerAdmin();
    bool isBulkPriceAdmin = opUserToken.IsBulkPriceAdmin();
    bool isRealSA = opUserToken.IsRealSA(); // This ensures that user is an SA and not a Customer Admin

    if (isSuper)
    {
        superPrefix = "Super ";
        extraUserPrivsDetail.Add("Super " + usrRole + " User");
    }

    if (isCustomerAdmin) { extraUserPrivsDetail.Add("Accounts Administrator"); }
    if (usrRole == "SA" && !isRealSA) { usrRoleExtension = "Account"; } // Mark neutered SA role because this is a customer admin
    if (isTester) { extraUserPrivs += "T"; extraUserPrivsDetail.Add("System Tester"); }
    if (isBulkPriceAdmin) { extraUserPrivs += "B"; extraUserPrivsDetail.Add("Bulk Pricing Admin"); }
    if (isDeveloper) { extraUserPrivs += "D"; extraUserPrivsDetail.Add("System Developer"); }
    if (extraUserPrivs == "STD") { extraUserPrivs = "STuD"; } // We practice SAFE CODING on this project
    if (extraUserPrivs != "") { extraUserPrivs = "- " + extraUserPrivs; }

    var env = ViewBag.AppToken == null || ViewBag.AppToken.OpEnvironment == null || ViewBag.AppToken.OpEnvironment.EnvLoc == null ? "UNKNOWN" : ViewBag.AppToken.OpEnvironment.EnvLoc.Location;
    //TODO: Fetch it from DB
    var GAID = "G-GREMQTR6VE";
    if (env == "PROD") { GAID = "G-8RK3YRJ3GX"; }
}

<!-- #region Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=@GAID"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date()); gtag('config', '@GAID');
</script>
<!-- #endregion -->

<div id="smbWindow" style="padding: 0; overflow: hidden !important;"></div>

<script>
    function clearSessionData(newPath) {
        localStorage.clear(); // clear local storage
        sessionStorage.clear(); // clear session storage

        // Clear cookies too
        var cookies = document.cookie;

        if (cookies !== "") {
            for (var i = 0; i < cookies.split(";").length; ++i) {
                var myCookie = cookies.split(";")[i];
                var pos = myCookie.indexOf("=");
                var name = pos > -1 ? myCookie.substr(0, pos) : myCookie;
                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
            }
        }

        window.location = newPath;
    }
    window.isEditableGrid = "True";
    window.usrRole = "@usrRole";
    window.usrRoleId = parseInt("@usrRoleId");
    window.usrName = "@usrName";
    window.usrWwid = "@usrWwid";
    window.usrDupWwid = "@usrWwid";
    window.usrEmail = "@usrEmail";
    window.isSuper = "@isSuper" === "True";
    window.usrVerticals = "@usrVerticals";
    window.appVer = "@appVer";
    window.usrDupWwid = "@usrWwid";
    window.isDeveloper = "@isDeveloper" === "True";
    window.isCustomerAdmin = "@isCustomerAdmin" === "True";
    window.isBulkPriceAdmin = "@isBulkPriceAdmin" === "True";
    window.isTester = "@isTester" === "True";
    window.isReportingUser = "@isReportingUser" === "True";
    window.env = "@env";
    window.isRealSA = "@isRealSA" === "True";
    window.superPrefix = "@superPrefix";
    window.usrRoleExtension = "@usrRoleExtension";
    window.extraUserPrivs = "@extraUserPrivs";
</script>