<form style="margin-top: 10px;" class="form-horizontal">

    <div ng-include="'app/admin/rules/rulesSimulationModal.html'"></div>

    <div ng-if="!vm.isEditmode" class="col-md-12">
        <h3>Auto-Approval Rules Administration Screen</h3>
    </div>
    <div ng-if="!vm.isEditmode" class="row" style="padding: 0 0 0 40px;">
        <div class="col-md-6" style="text-align: left;">
            <p style="color: #FC4C02">This screen allows DA users to create automated approval rules to streamline their work</p>
        </div>
    </div>

    <div ng-if="!vm.isEditmode" class="col-md-12">
        <!-- Grid buttons added by script below before styles -->
        <div kendo-grid class="table" expand-k-grid options="vm.gridOptions"></div>
    </div>

    <div ng-if="vm.isEditmode">
        <div ng-show="false" class="form-group row">
            <label class="control-label col-md-2">Rule:</label>
            <div class="col-md-9">
                <select class="form-control md"
                        kendo-combo-box
                        k-options="vm.ruleOptions"
                        ng-model="vm.rule.Id"
                        style="width:100%"></select>
            </div>
        </div>

        <div class="col-md-11" style="font-size: 12px; margin: 0; padding: 0; text-align: right;" ng-if="vm.rule.ChangedBy.length > 0">
            Last modified by <span style="color:#00AEEF">{{vm.rule.ChangedBy}}</span> on <span style="color:#00AEEF">{{vm.rule.ChangeDateTimeFormat}} GMT</span>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-2"><span style="color: red">*</span>Name:</label>
            <div class="col-md-9">
                <input required class="form-control md"
                       type="text"
                       ng-model="vm.rule.Name"
                       style="width:100%">
            </div>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-2"><span style="color: red">*</span>Owner:</label>
            <div class="col-md-9">
                <select kendo-combo-box
                        k-options="vm.ownerOptions"
                        ng-model="vm.rule.OwnerId"
                        style="width:100%"></select>
            </div>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-2">Rule Status:</label>
            <span class="col-md-2" style="float: left;">
                <div class="tooltipPriceRule">
                    <toggle class="fl toggle-accept"
                            ng-model="vm.rule.IsActive"
                            on="Active"
                            off="Inactive"
                            onstyle="btn-success"
                            offstyle="btn-danger"
                            title="{{vm.rule.IsActive == true ? 'Active' : 'Awaiting Approval'}}"></toggle>
                    <!--<span ng-if="vm.rule.IsActive" class="tooltipPriceRuletext tooltipPriceRuleGreen">Active</span>
                    <span ng-if="!vm.rule.IsActive" class="tooltipPriceRuletext tooltipPriceRuleYellow">Awaiting Approval</span>-->
                </div>
            </span>

            <label class="control-label col-md-2" style="float: left;">Approval Status:</label>
            <span class="col-md-2" style="margin-left:-15px; float: left;">
                <div class="tooltipPriceRule">
                    <toggle class="fl toggle-accept" ng-disabled="vm.isApprovedButtonReq"
                            ng-model="vm.rule.RuleStage"
                            on="Approved"
                            off="Pending Approval"
                            onstyle="btn-success"
                            offstyle="btn-danger"
                            title="{{vm.rule.RuleStage == true ? 'Approved' : 'Pending Approval'}}"></toggle>
                    <!--<span ng-if="vm.rule.RuleStage" class="tooltipPriceRuletext tooltipPriceRuleGreen">Approved</span>
                    <span ng-if="!vm.rule.RuleStage" class="tooltipPriceRuletext tooltipPriceRuleYellow">Pending Approval</span>-->
                </div>
            </span>

            <label class="control-label col-md-1" style="float: left;">Rule Type:</label>
            <span class="col-md-2" style="margin-left:-15px; float: left;">
                <div class="tooltipPriceRule">
                    <toggle class="fl toggle-accept"
                            ng-model="vm.rule.IsAutomationIncluded"
                            on="Auto Approval"
                            ng-click="vm.toggleType(vm.rule.IsAutomationIncluded)"
                            off="Exclusion Rule"
                            onstyle="btn-success"
                            offstyle="btn-danger"
                            title="{{vm.rule.IsAutomationIncluded == true ? 'Auto Approval' : 'Exclusion from Automation'}}"></toggle>
                    <!--<span ng-if="vm.rule.IsAutomationIncluded" class="tooltipPriceRuletext tooltipPriceRuleGreen">Approval Rule</span>
                    <span ng-if="!vm.rule.IsAutomationIncluded" class="tooltipPriceRuletext tooltipPriceRuleRed">Exclusion from Automation</span>-->
                </div>
            </span>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-2"><span style="color: red">*</span>Rule Start Date:</label>
            <div class="col-md-2">
                <input kendo-date-picker
                       placeholder="From date"
                       k-ng-model="vm.rule.StartDate"
                       style="width: 100%;" />
            </div>
            <label class="control-label col-md-1"><span style="color: red">*</span>End Date:</label>
            <div class="col-md-2" style="margin-left:-15px">
                <input kendo-date-picker
                       placeholder="To date"
                       k-ng-model="vm.rule.EndDate"
                       style="width: 100%;" />
            </div>
        </div>


        <div class="form-group row">
            <label class="control-label col-md-2">Notes:</label>
            <div class="col-md-9">
                <textarea type="textarea" rows="5" ng-model="vm.rule.Notes" style="width:100%"></textarea>
            </div>
        </div>

        <div class="form-group row">
            <label class="control-label col-md-2">Criteria:</label>
            <div class="col-md-9">
                <div rule-attribute-builder
                     grid-id="'attributeGrid'"
                     operator-settings="operatorSettings"
                     attribute-settings="attributeSettings"
                     criteria="vm.rule.Criteria"
                     custom-settings="">
                </div>
            </div>
        </div>

        <div class="form-group row" id="blanketDiscountSection">
            <label class="control-label col-md-2">Blanket Discount:</label>
            <div class="col-md-6" id="blanket_section">
                <span>Requested ECAP must be no less than</span>
                <input kendo-numeric-text-box ng-model="vm.BlanketDiscountPercentage" ng-change="vm.EditBlanketDiscountPercentage()" k-decimals="0" k-format="'#'" k-min="0" k-max="70" style="width: 100px;font-size:11px;" />
                <span>%&nbsp;Or&nbsp;$</span>
                <input kendo-numeric-text-box ng-model="vm.BlanketDiscountDollor" ng-change="vm.EditBlanketDiscountDollor()" k-format="'n2'" k-min="0" style="width: 130px;font-size:11px;" />
                <span>off of CAP</span>
            </div>
        </div>
    </div>
    <div class="form-group row" id="productCriteria">
        <label class="control-label col-md-2">Product Criteria:</label>
        <div class="col-md-9">
            <kendo-spreadsheet id="spreadsheetProductCriteria" style="width: 602px; height: 300px; margin-right: 25px;  float:left;" k-options="spreadSheetOptions" k-scope-field="spreadsheet" k-sheets="sheets"></kendo-spreadsheet>
            <button ng-click="vm.validateProduct(true,false,false)" class="btn btn-primary" style="float: left;">Validate Products</button>
        </div>
    </div>
    <div class="form-group row action_btns" ng-if="vm.isEditmode">
        <label class="control-label col-md-2"></label>
        <div class="col-md-9">
            <button ng-click="vm.saveRule(false,true)" class="btn btn-primary" style="margin-left: 15px">Save as Draft</button>
            <button ng-click="vm.saveRule(true,true)" class="btn btn-primary" style="margin-left: 15px">Save and Send for Approval</button>
            <button ng-click="vm.cancel()" class="btn btn-primary" style="margin-left: 15px">Cancel</button>
            <button ng-click="vm.simulate()" class="btn btn-success" style="margin-left: 15px;">Simulate Running this Rule</button>
        </div>
    </div>
    <div class="form-group row" id="productCriteria">&nbsp;</div>
</form>

<script id="grid_toolbar_addrulebutton" type="text/x-kendo-template">
    <a role="button" class="k-button k-button-icontext k-grid-add" ng-click="vm.addNewRule()">
        <span class="k-icon k-i-plus" style="color: white !important"></span>Add New Rule
    </a>
    <a role="button" class="k-button k-button-icontext k-grid-add" ng-click="vm.exportToExcel()">
        <span class="intelicon-ms-excel-outlined" style="margin-right:5px"></span>Export to Excel
    </a>
    <a role="button" class="k-button k-button-icontext k-grid-add" ng-click="vm.openRulesSimulation('test')">
        <span class="intelicon-lab" style="color: white !important; margin-right:5px"></span>Simulate Running Rules
    </a>
</script>

<style>
    .k-grid-toolbar > .k-grid-add > .k-icon{
        font-size: 18px !important;
        margin-top: 3px;
    }
    /*
        .tooltipPriceRule {
        position: relative;
        display: inline-block;
        width: 100%;
    }

        .tooltipPriceRule .tooltipPriceRuleGreen {
            background-color: green !important;
            color: white !important;
        }

    .btn-success {
         background-color: #11EE7A;
         color: #000000;
     }   

     .btn-danger {
         background-color: #EE7A11;
     }  

    #spreadsheetProductCriteria {
        border: none;
    }

        #spreadsheetProductCriteria .k-dirty-cell {
            border: none !important;
            color: red !important;
        }

        #spreadsheetProductCriteria .k-spreadsheet-formula-bar, #spreadsheetProductCriteria .k-spreadsheet-name-editor {
            display: none !important;
        }


    .clrGreen {
        color: #2196f3 !important;
    }

    .clrRed {
        color: #ff5722 !important;
    }

    .btnYellow {
        color: #F3D54E !important;
    }

    .k-grid td, .k-grid td div {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
    }

    .toggle-accept {
        width: 75% !important;
    }

    .k-grid td {
        height: 30px !important;
    }

    div.k-spreadsheet-formula-bar,
    .k-spreadsheet-top-corner, .k-spreadsheet-row-header {
        display: block !important;
    }

    .k-spreadsheet-cell-context-menu li:nth-child(5), .k-spreadsheet-cell-context-menu li:nth-child(4) {
        display: none;
    }

    /*.k-spreadsheet-action-bar {
        display: none !important;
    }*/

    /*.k-spreadsheet-fixed-container {
        margin-left: -33px;
    }*/

    .k-grid-header, .k-grid-header .k-header, .k-pager-wrap, .k-pager-numbers .k-state-selected, .k-grid-footer, .k-grid-footer td, .k-scheduler-header, .km-pane-wrapper .k-grid-header .k-header {
        background-color: #ffffff !important;
    }

        #secEngineGrid.k-grid .k-filter-row th, .k-grid-header th.k-header {
            font-size: 12px;
            border-bottom: solid #dedede 2px;
        }

    .k-grid .k-icon {
        color: #3343a4 !important;
        opacity: 1;
    }

    .k-grid .k-alt {
        background-color: rgba(241, 241, 241, 0.17) !important;
    }

    .dealTools .md-icon {
        padding: 4px 0 0 5px;
    }

    .true {
        background-color: rgb(196, 214, 0) !important;
    }

    .dealTools .md-icon i {
        color: #00AEEF !important;
    }

        .dealTools .md-icon i:hover {
            color: #003C71 !important;
        }

    .dealTools .md-icon-disabled {
        padding: 4px 2px 0 1px;
    }

        .dealTools .md-icon-disabled i {
            color: #00AEEF;
        }

    .dealTools {
        /*margin-left: -5px !important;*/
    }

    .dealTools {
        line-height: 1.8em;
        height: 100% !important;
        width: 100%;
    }

        .dealTools .gridStatusMarker {
            font-family: arial;
        }

        .dealTools a {
            text-decoration: none;
        }

        .dealTools i:hover {
            color: #003C71;
        }

    .gridStatusMarker {
        width: 16px;
        color: #000000;
        background-color: #cccccc;
        font-size: 14px;
        font-weight: 600;
        padding: 4px 2px 4px 7px;
        margin-left: -10px;
        margin-right: 5px;
    }

        .gridStatusMarker.Working {
            color: #000000;
            background-color: #FFA300;
        }

        .gridStatusMarker.Active {
            color: #000000;
            background-color: #C4D600;
        }

        .gridStatusMarker.Cancelled {
            color: #000000;
            background-color: #cccccc;
        }

    .dealTools .md-icon {
        padding: 4px 0 0 5px;
    }

    .ruleName {
        cursor: pointer;
    }

        .ruleName:hover {
            color: #abadaf;
        }

    .k-tabstrip-wrapper, .k-tabstrip-bottom, .k-spreadsheet-sheets-bar-add {
        display: none;
    }

    #blanket_section span {
        font-size: 12px;
    }

    .k-button {
        color: #fff;
        background-color: #0071c5;
        border-color: #0071c5;
        box-shadow: none;
    }

        .k-button:hover {
            background-color: #00aeef;
            border-color: #00aeef;
            color: #fff;
            box-shadow: none;
        }

    .tmpltItem {
        width: 100%;
    }

    .tmpltIcn {
        width: 35px;
    }

        .tmpltIcn i {
            font-size: 26px;
        }

    .tmpltContract {
    }

    .tmpltRole {
        font-size: 12px;
    }

    .tmpltPrimary {
        font-size: 14px;
        line-height: 1.1em;
    }

    .tmpltSecondary {
        font-size: 12px;
        line-height: 1.1em;
        opacity: 0.6;
    }

    .toggle {
        width: 100% !important;
    }

    .rulesGidIcon {
        font-size: 20px;
        margin: 2px;
        color: #aaa;
        margin-right: 5px;
    }

    .action_btns {
        margin-bottom: 20px;
    }

    .abValue {
        max-width: 58%;
    }
</style>
<script>
    $(document).ready(function () {
        $('#bodyContent').attr('style', 'overflow: auto !important');
        $($('#spreadsheetProductCriteria .k-spreadsheet-column-header').find('div')[0]).find('div').html('Product Name (Only Lvl 4 or Material Ids Allowed)');
        $($('#spreadsheetProductCriteria .k-spreadsheet-column-header').find('div')[2]).find('div').html('ECAP Floor (US$)');        
    });
</script>