<link href="css/productselector.css" rel="stylesheet" />
<div class="product-selector modal-content" moveablemodal style="height:85vh;background-color:#1a3e6f;overflow-y:auto;overflow-x:hidden;border-left:1px solid #1a3e6f;border-right:1px solid #1a3e6f;;">
    <div class="prodSelector modal-header">
        <div class="row">
            <div class="col-md-4 col-sm-4 col-xs-4">
                <p class="prodHeader cursorArea">Product Selector <img ng-if="loading" src="/Images/loadingSmall.gif" style="margin-left: 25px;" /></p>
            </div>
            <div class="col-md-8 col-sm-8 col-xs-8 prodSelectorSearch">
                <div class="modalCloseIcon fr">
                    <i role="button" title="Close" class="intelicon-close-max" ng-click="vm.cancel()"></i>
                </div>
                <button class="btn btn-default prdBtn fr" ng-click="vm.clearSearch()" style="margin: 0 0 0 8px;">Clear</button>
                <button class="btn btn-primary prdBtn fr" ng-click="vm.searchProduct()" style="margin: 0 0 0 10px;">Search</button>
                <input id="productSearch"
                       class="prod-autocomplete fr form-control input-sm"
                       ng-model="vm.userInput"
                       ng-keyup="$event.keyCode == 13 ? vm.searchProduct() : null"
                       type="text"
                       kendo-autocomplete
                       k-options="vm.productOptions"
                       k-data-value-field="'PRD_MBR_SID'" />
            </div>
        </div>
        <div ng-if="!vm.showTree" class="row breadCrumbWrapper">
            <ul class="productSelectorpath breadcrumb">
                <li><a role="button" class="prdAnchor" ng-click="vm.selectPath(0)">{{vm.drillDownPrd}}</a></li>
                <li ng-repeat="p in vm.selectedPathParts | unique:'name'" ng-if="p.name != 'NA'">
                    <a role="button" class="prdAnchor" ng-click="vm.selectPath($index + 1)">{{:: p.name }}</a>
                </li>
            </ul>
        </div>
        <div ng-if="vm.showTree" class="textProdSelector" style="margin-bottom:17px;margin-top:4px;">
            Selected Products:
        </div>
    </div>
    <div style="height:80%">
        <div class="prodSelector modal-body">
            <div ng-if="vm.showSuggestions" class="productSelector subHeaderNavContainer mini-right miniProdNav">
                <div ng-if="!(vm.errorMessage.length > 0)">
                    <div ng-if="!vm.disableSelection">{{vm.suggestionText}}</div>
                    <div class="productSelector Issue" ng-if="vm.disableSelection">Product(s) does not match the global filter criteria or is not active within the deal date range.</div>
                    <div style="padding-top:5px;">
                        <table ng-if="vm.suggestedProducts.length !== 0" style="width: 100%; height: 100%;table-layout:fixed">
                            <tr>
                                <td style="width:20%;min-width:20px;max-width:200px">
                                    <div class="leftNavFilter">
                                        <div class="filterTitleUnderline" ng-if="vm.curRowIssues.length > 0">Products Found</div>
                                        <div class="filterGrp">
                                            <div class="filterContainer" uib-collapse="vm.isPrdCollapsed">
                                                <div ng-repeat="item in vm.curRowIssues | orderBy: 'name'" style="max-height: 23px;" ng-class="{'lblSelected': item.selected, 'lblNotSelected': !item.selected}">
                                                    <div ng-if="item.cnt > 0">
                                                        <input type='checkbox' ng-click="vm.clickFilter()" ng-model="item.selected" class='check ckSm with-sm-font' id="fltrPrdChk{{item.id}}" />
                                                        <label for="fltrPrdChk{{item.id}}" class="lblFilterProd">
                                                            <span ng-bind-html="item.name"></span>
                                                            <span class="badge upperBadge" ng-if="item.status == 'Issue'">{{ item.cnt == 0 ? "?" : item.cnt }}</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="filterTitleUnderline" ng-if="vm.curRowLvl.length > 1">Product Level</div>
                                        <div class="filterGrp" ng-if="vm.curRowLvl.length > 1">
                                            <div class="filterContainer" uib-collapse="vm.isLvlCollapsed">
                                                <div ng-repeat="item in vm.curRowLvl | orderBy: 'name'" style="max-height: 23px;" ng-class="{'lblSelected': item.selected, 'lblNotSelected': !item.selected}">
                                                    <input type='checkbox' ng-click="vm.clickFilter()" ng-model="item.selected" class='check ckSm with-sm-font' id="fltrLvlChk{{item.id}}" />
                                                    <label for="fltrLvlChk{{item.id}}" class="lblFilterProd">
                                                        <span ng-bind-html="item.name"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="filterTitleUnderline" ng-if="vm.curRowCategories.length > 1">Product Category</div>
                                        <div class="filterGrp" ng-if="vm.curRowCategories.length > 1">
                                            <div class="filterContainer" uib-collapse="vm.isCatCollapsed">
                                                <div ng-repeat="item in vm.curRowCategories | orderBy: 'name'" style="max-height: 23px;" ng-class="{'lblSelected': item.selected, 'lblNotSelected': !item.selected}">
                                                    <!-- checked='checked' ng-click="onColumnChange(item)" -->
                                                    <input type='checkbox' ng-click="vm.clickFilter()" ng-model="item.selected" class='check ckSm with-sm-font' id="fltrCatChk{{item.id}}" />
                                                    <label for="fltrCatChk{{item.id}}" class="lblFilterProd">
                                                        <span ng-bind-html="item.name"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div id="prodSuggestions" kendo-grid-check-box k-grid-checkbox="vm" kendo-grid="prodSuggestions" class="productSuggestion opUiContainer md kendoGridHeight productSuggestion-grid k-grid" k-options="vm.gridOptionsSuggestions"></div>
                                </td>
                            </tr>
                        </table>
                        <div class="productSelector Warning" ng-if="vm.suggestedProducts.length === 0">
                            Unable to find any products for "{{::vm.userInput}}."
                        </div>
                    </div>
                </div>
                <div class="productSelector Issue" ng-if="vm.errorMessage.length > 0">
                    {{vm.errorMessage}}
                </div>
            </div>
            <div ng-if="vm.showTree && !vm.showSuggestions">
                <div class="k-treelist product" kendo-tree-view k-options="vm.tree">
                    <div k-template>
                        {{dataItem.name}}
                    </div>
                </div>
            </div>
            <div ng-if="!vm.showTree && !vm.showSuggestions">
                <div ng-if="!vm.hideSelection" ng-switch="vm.getDisplayTemplate()">
                    <div ng-switch-when="btnGroup" class="row" style="padding-left:10px;padding-right:10px;font-size:16px;">
                        <div class="drillDown btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" ng-repeat="p in vm.items | orderBy:'name'" role="group">
                                <div ng-class="{'input-group':p.allowMultiple}">
                                    <span ng-if="p.allowMultiple" ng-class="{'input-group-addon':p.allowMultiple}">
                                        <input id="{{p.name}}" class="check with-sm-font" ng-click="vm.selectProduct(p)" ng-model="p.selected" type="checkbox">
                                        <label style="margin-bottom:0px;" for="{{p.name}}"></label>
                                    </span>
                                    <button ng-if="!(vm.selectedPathParts.length < 2)" title="{{p.name}}" type="button" ng-class="{'noborder':$last}" ng-click="vm.selectItem(p)" class="btn btn-default">
                                        {{::vm.checkForBlank(p.name)}}
                                    </button>
                                    <button ng-if="(vm.selectedPathParts.length < 2)" kendo-tooltip k-content="vm.getVerticalsUnderMarkLevel(p.name)"
                                            type="button" ng-class="{'noborder':$last}" ng-click="vm.selectItem(p)" class="btn btn-default">
                                        {{::vm.checkForBlank(p.name)}}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-switch-when="btnGrid" class="row" style="margin:2px;">
                        <div ng-repeat="p in vm.items | orderBy:'name'">
                            <div class="clearfix" ng-if="$index % 4 == 0"></div>
                            <div class="col-sm-3 prodDrillDownLarge" title="{{::vm.checkForBlank(p.name)}}" ng-class="{'noLeftBorder':$index % 4 == 0}">
                                <div ng-class="{'input-group':p.allowMultiple}" class="drillDown">
                                    <span ng-if="p.allowMultiple" ng-class="{'input-group-addon':p.allowMultiple}">
                                        <input id="{{p.name}}" class="check with-sm-font" ng-click="vm.selectProduct(p)" ng-model="p.selected" type="checkbox">
                                        <label style="margin-bottom:0px;" for="{{p.name}}"></label>
                                    </span>
                                    <p role="button" ng-click="vm.selectItem(p)">{{::vm.checkForBlank(p.name)}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-switch-default="ng-switch-default">
                        <div id="prodGrid" kendo-grid="prodGrid" kendo-grid-check-box k-grid-checkbox="vm" class="prodSelector opUiContainer md prodSelector-grid k-grid kendoGridHeight" k-options="vm.gridOptionsProduct"></div>
                    </div>
                </div>
                <div ng-if="vm.hideSelection">
                    <div class="row" ng-if="vm.searchItems.length > 0" style="padding-left:10px;padding-right:10px;font-size:16px;">
                        <div class="drillDown btn-group btn-group-justified" role="group" aria-label="...">
                            <div class="btn-group" ng-repeat="p in vm.searchItems | orderBy:'name' " role="group">
                                <button type="button" title="{{p.name}}" ng-class="{'noborder':$last}" ng-click="vm.selectsearchItem(p)" class="btn btn-default">{{::p.name}}</button>
                            </div>
                        </div>
                    </div>
                    <div ng-if="vm.showSearchResults">
                        <div id="prodGrid" kendo-grid="prodGrid" kendo-grid-check-box k-grid-checkbox="vm" class="prodSelector opUiContainer md prodSelector-grid k-grid kendoGridHeight" k-options="vm.gridOptionsProduct"></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="padding:15px;">
            <div ng-if="vm.excludeMode">
                <span>
                    <span class="text-left textProdSelector">
                        Excluded Products
                        <span ng-class="{'animate':vm.animateExclude}" class="arcAnimate">
                            <small role="button">&nbsp;({{vm.excludedProducts.length}})</small>
                        </span>
                    </span>
                </span>
                <trashcan title="Clear excluded products" class="fr" ng-click="vm.clearProducts('E')"></trashcan>
            </div>
            <div ng-if="!vm.excludeMode" class="row">
                <div ng-class="{'col-md-6':vm.enableMultipleSelection, 'paddingRight15':vm.dealType!='VOL_TIER'}">
                    <span ng-class="{'paddingLeft15':vm.dealType!='VOL_TIER'}">
                        <span ng-class="{'paddingLeftNone':vm.enableMultipleSelection}" class="text-left textProdSelector">
                            Selected Products
                            <span ng-class="{'animate':vm.animateInclude}" class="arcAnimate">
                                <small role="button">&nbsp;({{vm.addedProducts.length}})</small>
                            </span>
                        </span>
                    </span>
                    <trashcan title="Clear products" class="fr" ng-click="vm.clearProducts()"></trashcan>
                </div>
                <div ng-if="vm.enableMultipleSelection" class="col-md-6">
                    <span>
                        <span class="paddingRightNone text-left textProdSelector">
                            Excluded Products
                            <span ng-class="{'animate':vm.animateExclude}" class="arcAnimate">
                                <small role="button">&nbsp;({{vm.excludedProducts.length}})</small>
                            </span>
                        </span>
                    </span>
                    <trashcan title="Clear excluded products" class="fr" ng-click="vm.clearProducts('E')"></trashcan>
                </div>
            </div>
            <div ng-if="!vm.excludeMode" class="row" style="padding-left:15px;padding-right:15px;">
                <div ng-class="{'col-md-6':vm.enableMultipleSelection,'paddingLeftNone':vm.enableMultipleSelection}">
                    <ui-select allow-clear="true" onkeypress="return false;" class="prodSelected text-left"
                               tagging="true" multiple ng-model="vm.addedProducts" theme="bootstrap">
                        <ui-select-match>
                            <span ng-class="{'text-danger': vm.isValidCapDetails($item)}" ng-click="vm.showSingleProductHeirarchy($item)"
                                  title="{{vm.isValidCapDetails($item, true)}}">{{$item.HIER_VAL_NM}}</span>
                        </ui-select-match>
                        <ui-select-choices repeat="products in vm.selectedProducts">
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div ng-if="vm.enableMultipleSelection" class="col-md-6 paddingRightNone">
                    <ui-select allow-clear="true" onkeypress="return false;" class="prodSelected text-left"
                               tagging="true" multiple ng-model="vm.excludedProducts" theme="bootstrap">
                        <ui-select-match>
                            <span ng-class="{'text-danger': vm.isValidCapDetails($item)}"
                                  title="{{vm.isValidCapDetails($item, true)}}">{{$item.HIER_VAL_NM}}</span>
                        </ui-select-match>
                        <ui-select-choices repeat="products in vm.selectedProducts">
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div ng-if="vm.excludeMode" class="row" style="padding-left:15px;padding-right:15px;">
                <div>
                    <ui-select allow-clear="true" onkeypress="return false;" class="prodSelected text-left"
                               tagging="true" multiple ng-model="vm.excludedProducts" theme="bootstrap">
                        <ui-select-match>
                            <span ng-class="{'text-danger': vm.isValidCapDetails($item)}"
                                  title="{{vm.isValidCapDetails($item, true)}}">{{$item.HIER_VAL_NM}}</span>
                        </ui-select-match>
                        <ui-select-choices repeat="products in vm.selectedProducts">
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <br />
            <div class="form-inline insertAtRowsText">
                <span ng-if="vm.enableSplitProducts">
                    <input id="separateProduct" class="checkbox-custom" ng-model="vm.splitProducts" name="separateroducts" type="checkbox">
                    <label for="separateProduct" class="checkbox-custom-label" style="padding-bottom:5px;margin-top:0px;">&nbsp;Separate product in rows</label>
                </span>
                <button class="btn btn-primary fr prdBtn" ng-disabled="!vm.excludeMode && vm.addedProducts.length == 0" ng-click="vm.save()">Save</button>
                <button class="btn btn-default fr prdBtn" ng-click="vm.cancel()" style="margin-right:4px;">Cancel</button>
            </div>
        </div>
    </div>
</div>
