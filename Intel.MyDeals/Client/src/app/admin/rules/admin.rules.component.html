<link href="/Client/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="/Client/node_modules/@progress/kendo-theme-bootstrap/dist/all.css" rel="stylesheet" />
<link href="/Client/node_modules/@angular/material/prebuilt-themes/indigo-pink.css" rel="stylesheet" />
<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-10 k-header-alignment price-rules-style">
        <h3>Auto-Approval Rules Administration Screen</h3>
    </div>
    <div *ngIf="toolKitHidden == false" class="col-md-2 ng-scope help">
        <h3><a target="_blank" href="https://wiki.ith.intel.com/display/Handbook/Tender+Price+Rules" title="Intel wiki link for help"><i class="intelicon-help-solid"></i></a></h3>
    </div>
</div>
<div class="row componentLabel">
    <div class="col-md-6">
        <p>This screen allows DA users to create automated approval rules to streamline their work</p>
    </div>
</div>
<div class="col-md-12 kendo-grid-buttons grid-size-style">
    <kendo-grid class="runprice-grid-style" [data]="gridData" [loading]="isLoading" [resizable]="true" [pageSize]="state.take" [skip]="state.skip"
                [sort]="state.sort" [filter]="state.filter" [sortable]="true"
                [pageable]="{type:type,pageSizes: pageSizes,info:info,refresh:true}" [groupable]="false"
                [group]="state.group" filterable="menu" (dataStateChange)="dataStateChange($event)" (excelExport)="onExcelExport($event)"
                [ngClass]="isTextIncrease? 'opUiContainer md k-grid k-widget' : 'opUiContainer sm k-grid k-widget'">
        <ng-template kendoGridToolbarTemplate>
            <button *ngIf="toolKitHidden == false" [disabled]="isLoading" kendoGridAddCommand class="k-button addButton" (click)="addNewRule()">
                <span class="k-icon k-i-plus-outline k-icon-md"></span><span class="simulate-title-sty">ADD NEW RULE</span>
            </button>
            <button *ngIf="toolKitHidden == false && rid != 0" [disabled]="isLoading" class="k-button addButton" (click)="removeFilter()">
                <span class="k-icon intelicon-cancel-filter-solid k-icon-md k-family"></span>REMOVE FILTER
            </button>
            <button *ngIf="toolKitHidden == false" [disabled]="isLoading" class="k-button" kendoGridExcelCommand icon="file-excel">
                <span class="simulate-title-sty">EXPORT TO EXCEL</span>
            </button>
            <button class="k-button" [disabled]="isLoading" (click)="openMessage('test')">
                <span class="intelicon-lab" style="margin:1px"></span><span class="simulate-title-sty">SIMULATE RUNNING RULES</span>
            </button>
            <kendo-grid-spacer></kendo-grid-spacer>
            <button [disabled]="isLoading" class="k-button button btnMargin">
                <i id="btnEnlargeText" (click)="isFontSizeChange()" [ngClass]="isTextIncrease? 'intelicon-shrink' : 'intelicon-expand'" title={{isTextFontTitle}}></i>
            </button>
            <button [disabled]="isLoading" class="k-button button">
                <i id="btnWordWrapControl" (click)="isExpandable()" [ngClass]="isExpand?'intelicon-increase-text-outlined': 'intelicon-decrease-text-outlined'" title={{isExpandTitle}}></i>
            </button>
            <button (click)="refreshGrid()" [disabled]="isLoading" class="k-button clearButton">
                <span class="k-icon k-i-reload k-icon-md"></span>Refresh
            </button>
        </ng-template>
        <kendo-grid-command-column width="200" [headerClass]="{'headerClass':true}" [columnMenu]="false">
            <ng-template *ngIf="toolKitHidden == false" kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div class='fl gridStatusMarker centerText {{dataItem.RuleStage}}' [title]="dataItem.RuleStage? 'Approved' : 'Pending Approval'">{{ stageOneChar(dataItem.RuleStage) }}</div>
                <div class="rule">
                    <i [title]="dataItem.IsAutomationIncluded ? 'Auto Approval' : 'Exclusion from Automation'" class='rulesGidIcon {{ stageOneCharStatus(dataItem.IsAutomationIncluded) }} dealTools'></i>
                    <i role='button' title='Edit' class='rulesGidIcon intelicon-edit dealTools' (click)="editRule(dataItem.Id,false)"></i>
                    <i role='button' title='Copy' class='rulesGidIcon intelicon-copy-solid dealTools' (click)="copyRule(dataItem.Id)"></i>
                    <i role='button' title='Delete' class='rulesGidIcon intelicon-trash-solid dealTools' (click)="deleteRule(dataItem.Id)"></i>
                    <i *ngIf="isApprove(dataItem)" role='button' title='Approve' class='rulesGidIcon intelicon-user-approved-selected-solid dealTools' (click)="UpdateRuleIndicator(dataItem.Id, true,'UPDATE_STAGE_IND',true)"></i>
                </div>
            </ng-template>
        </kendo-grid-command-column>
        <kendo-grid-column [headerClass]="{'headerClass':true}" field="Id" title="Id" [hidden]=true>
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="320" [headerClass]="{'headerClass':true}" field="Name" title="Name">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div *ngIf="toolKitHidden == true">{{dataItem.Name}}</div>
                <div *ngIf="toolKitHidden == false"><a class='ruleName admin-name' (click)="editRule(dataItem.Id,false)" title='Click to Edit'><span>#{{dataItem.Id}}</span>:&nbsp;<span>{{dataItem.Name}}</span></a></div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="140" [headerClass]="{'headerClass':true}" field="RuleStatusLabel" title="Rule Status">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div [ngClass]="dataItem.IsActive ?'clrGreen': 'clrRed'">{{dataItem.RuleStatusLabel}}</div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="130" [headerClass]="{'headerClass':true}" field="StartDate" title="Start Date">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="130" [headerClass]="{'headerClass':true}" field="EndDate" title="End Date">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="140" [headerClass]="{'headerClass':true}" field="OwnerName" title="Owner Name">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div title={{dataItem.OwnerName}}>{{dataItem.OwnerName}}</div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="130" [headerClass]="{'headerClass':true}" field="ChangedBy" title="Updated By">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div title="{{dataItem.ChangedBy + ' @'+ dataItem.ChangeDateTimeFormat}}">{{dataItem.ChangedBy}}<br><font class="fontStyle">{{dataItem.ChangeDateTimeFormat}}</font></div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="170" [headerClass]="{'headerClass':true}" field="Notes" title="Notes">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div title={{dataItem.Notes}}>{{dataItem.Notes}}</div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column width="220" [headerClass]="{'headerClass':true}" field="RuleDescription" title="Rule Description">
            <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                         let-filterService="filterService">
                <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                   [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
            </ng-template>
            <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                <div [ngClass]="isExpand? 'btnHandle rulesDescription classToggle':'btnHandle rulesDescription'" [innerHTML]="dataItem.RuleDescription"></div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-excel fileName="Price Rule Export.xlsx" [fetchData]="allData">
            <kendo-excelexport-column *ngFor="let item of excelColumns | keyvalue : returnZero" field="{{item.key}}"
                                      title="{{item.value}}" [width]="item.key == 'RuleDescription' ? 300 : 150" [cellOptions]="cellOptions"
                                      [headerCellOptions]="headerCellOptions">
            </kendo-excelexport-column>
        </kendo-grid-excel>
        <ng-template kendoGridDetailTemplate let-dataItem>
            <kendo-grid [data]="convertToChildGridArray(dataItem)" style="height:fit-content">
                <kendo-grid-column *ngIf="dataItem.RuleDescription.length > 0" width="200" [headerClass]="{'headerClass':true}" field="RuleDescription" title="Rule Description">
                    <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                        <div [innerHTML]="dataItem.RuleDescription"></div>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column *ngIf="dataItem.ProductDescription.length > 0" width="200" [headerClass]="{'headerClass':true}" field="ProductDescription" title="Product Description">
                    <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem">
                        <div [innerHTML]="dataItem.ProductDescription"></div>
                    </ng-template>
                </kendo-grid-column>
            </kendo-grid>
        </ng-template>
    </kendo-grid>
    <kendo-dialog class="admin-delete-style" *ngIf="isDeletion">
        <p style="margin: 20px; text-align: center;">Are you sure want to delete this rule?</p>
        <kendo-dialog-actions class="del-admin">
            <button class='k-button admin-okbtn-style' (click)="deleteConfirmation()">OK</button>
            <button class='k-button admin-cancelbtn-style' (click)="cancelDeletion()">CANCEL</button>
        </kendo-dialog-actions>
    </kendo-dialog>
</div>