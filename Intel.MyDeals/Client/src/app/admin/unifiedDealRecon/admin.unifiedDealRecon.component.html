<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" /> 
<div class="row">
    <div class="col-md-6" style="padding-left: 30px; padding-top: 24px">
        <h3>Unified Deal Reconciliation</h3>
    </div>
    <div class="col-md-6"> 
        <button class="btn btn-primary" (click)="OpenRetriggerUnifyModal()" *ngIf="retrigger" style="float:right;margin-top:20px; margin-right:19px;">Retrigger UCD</button>
        <button class="btn btn-primary" (click)="OpenBulkUploadUnifyModal()" *ngIf="uploadUnifiedData" style="float:right;margin-top:20px; margin-right:41px;">Upload Unified Data</button>
        <button class="btn btn-primary" (click)="OpenUCDReprocessModal()" *ngIf="reprocessucd" style="float:right;margin-top:20px; margin-right:41px;">Reprocess UCD</button>
    </div>
</div>
<div class="row" style="display: contents;">
    <div class="col-md-12 kendo-grid-buttons">
        <div class="excel-sections">
            <button class="btn btn-sm dropdown-toggle tool-hover" style="padding-right: .5rem;" type="button" data-toggle="dropdown">
                <div class="excel-btn-update">
                    <i class="intelicon-ms-excel-outlined" style="font-size: 30px;color: #fff"></i>
                    <span>Excel Export</span>
                    <span class="caret" style="color: #fff; width: 10px;"></span>
                </div>
            </button>
            <ul class="dropdown-menu" id="excelDropDownMenu">
                <li (click)="exportToExcel()" style="cursor: pointer;"><a>Export All Columns, All Data</a></li>
                <li (click)="exportToExcelCustomColumns()" style="cursor: pointer;"><a>Export Current View</a></li>
            </ul>
        </div>
        <kendo-grid class="cm-height-table admin-deal-grid kAlignHeaders unify-deal-recon-optimize" [data]="gridData" [loading]="isLoading" [pageSize]="state.take"
                    [skip]="state.skip" [sort]="state.sort" [filter]="state.filter" [sortable]="true"  (pageChange)="pageChange($event)"
                    [pageable]="{type:type,pageSizes: pageSizes,info:info}" [groupable]="false" [group]="state.group"
                    filterable="menu" [navigable]="true" (dataStateChange)="dataStateChange($event)"
                    (edit)="editHandler($event)" (cancel)="cancelHandler($event)" (save)="saveHandler($event)"
                    (excelExport)="onExcelExport($event)" (sortChange)="sortChange($event)" (filterChange)="filterChange($event)">
            <ng-template kendoGridToolbarTemplate>
                <button (click)="clearFilter()" class="k-button clearButton filter-clear-text">
                    <span class="k-icon intelicon-cancel-filter-solid k-icon-md  k-family unifie-clear-filter"></span><span class="unifie-clear-text">Clear Filters</span>
                </button>
                <kendo-grid-spacer></kendo-grid-spacer>
                <button (click)="refreshGrid()" class="k-button clearButton">
                    <span class="k-icon k-i-reload k-icon-md"></span>Refresh
                </button>
            </ng-template>
            <kendo-grid-command-column width="100" *ngIf="editAccess" [headerClass]="{'headerClass':true}" [columnMenu]="false">
                <ng-template kendoGridCellTemplate let-isNew="isNew">
                    <div class="text-center">
                        <button style="cursor:pointer;" title='Edit' id="command-icon" class="k-command-icon unifie-edit-style" kendoGridEditCommand>
                            <span class="k-icon k-i-edit k-icon-sm"></span>
                        </button>
                    </div>
                    <div class="text-center">
                        <button id="command-icon" title="Save" class="k-command-icon" kendoGridSaveCommand
                                [disabled]="formGroup?.invalid">
                            <span class="k-icon k-i-check k-icon-sm"></span>
                        </button><button id="command-icon" title="Cancel"
                                         class="k-command-icon" kendoGridCancelCommand>
                            <span class="k-icon k-i-cancel-outline k-icon-sm cancel-space-r"></span>
                        </button>
                    </div>
                </ng-template>
            </kendo-grid-command-column>

            <kendo-grid-column [headerClass]="{'headerClass':true}" field="CNTRCT_OBJ_SID" title="Contract Id"
                               [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="TITLE" title="Contract/Tender Folio Name" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="OBJ_SID" title="Deal ID" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="END_CUSTOMER_RETAIL" title="End Customer Retail" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="END_CUSTOMER_COUNTRY" title="End Customer Country/Region" [editable]="false">

                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="EMP_WWID" title="Creator WWID">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-textbox [formControl]="formGroup.get('EMP_WWID')" [clearButton]="true"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="UNIFIED_STATUS" title="Status" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column [headerClass]="{'headerClass':true}" field="UNIFIED_REASON" title="Reason Info" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" (valueChange)="filterLoad(column.field)" [data]="GetColumnFilterData(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-excel fileName="MyDealsUnifiedRecon.xlsx" [fetchData]="allData">
                <kendo-excelexport-column *ngFor="let item of excelColumns | keyvalue : returnZero" field="{{item.key}}"
                                          title="{{item.value}}" [width]="150" [cellOptions]="cellOptions"
                                          [headerCellOptions]="headerCellOptions"></kendo-excelexport-column>
            </kendo-grid-excel>
        </kendo-grid>
    </div>
</div>
<kendo-dialog *ngIf="isWarning" class="endCustomerWarning unifie-window-dialog">
    <p style="margin: 30px; text-align: center;">{{message}}</p>
    <kendo-dialog-actions class="unifie-recon-action">
        <button class='k-button noRemoveWarning unifie-recon-ok k-buttonUnifiedDealRecon' (click)="cancelWarning()">OK</button>
    </kendo-dialog-actions>
</kendo-dialog>