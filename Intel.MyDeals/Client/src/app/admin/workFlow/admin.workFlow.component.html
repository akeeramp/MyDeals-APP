<!-- <link href="/Client/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" /> -->
<!-- <link href="/Client/node_modules/@progress/kendo-theme-bootstrap/dist/all.css" rel="stylesheet" /> -->
<!-- <link href="/Client/node_modules/@angular/material/prebuilt-themes/indigo-pink.css" rel="stylesheet" /> -->
<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" />
<div class="row" style="display: contents;">
    <div class="col-md-12 k-header-alignment header-correct">
        <h3 class="header-removebottom">Work Flow</h3>
    </div>
</div>
<div class="row" style="display: contents;">
    <div class="col-md-12 kendo-grid-buttons remove-space-lR">
        <kendo-grid [data]="gridData" [loading]="isLoading" [pageSize]="state.take" [skip]="state.skip"
                    [sort]="state.sort" [filter]="state.filter" [sortable]="true"
                    [pageable]="{type:type,pageSizes: pageSizes,info:info}" [groupable]="false" [group]="state.group"
                    filterable="menu" [navigable]="true" (dataStateChange)="dataStateChange($event)" (add)="addHandler($event)"
                    (edit)="editHandler($event)" (remove)="removeHandler($event)" (cancel)="cancelHandler($event)"
                    (save)="saveHandler($event)" [columnMenu]="true" #workflow_grid>
            <ng-template kendoGridToolbarTemplate>
                <button kendoGridAddCommand class="k-button addButton">
                    <span class="k-icon k-i-plus-outline k-icon-md"></span>ADD NEW RECORD
                </button><button (click)="clearFilter()" class="k-button clearButton">
                    <span class="k-icon intelicon-cancel-filter-solid k-icon-md k-family"></span>CLEAR FILTERS
                </button>
                <kendo-grid-spacer></kendo-grid-spacer>
                <button (click)="refreshGrid()" class="k-button clearButton">
                    <span class="k-icon k-i-reload k-icon-md"></span>Refresh
                </button>
            </ng-template>
            <kendo-grid-command-column title="Commands" width="150" [headerClass]="{'headerClass':true}"
                                       [columnMenu]="false">
                <ng-template kendoGridCellTemplate let-isNew="isNew">
                    <button id="command-icon" class="k-command-icon" kendoGridEditCommand>
                        <span class="k-icon k-i-edit k-icon-sm remove-space-de"></span>
                    </button><button id="command-icon"
                                     class="k-command-icon" kendoGridSaveCommand [disabled]="formGroup?.invalid">
                        <span class="k-icon k-i-check k-icon-sm"></span>
                    </button>
                    <button id="command-icon" class="k-command-icon" kendoGridCancelCommand>
                        <span class="k-icon k-i-cancel-outline k-icon-sm remove-spaceoutline"></span>
                    </button><button id="command-icon" class="k-command-icon" kendoGridRemoveCommand>
                        <span class="k-icon k-i-delete k-icon-sm"></span>
                    </button>
                </ng-template>
            </kendo-grid-command-column>
            <kendo-grid-column field="WF_SID" title="ID" width="100" [headerClass]="{'headerClass':true}"
                               [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WF_NM" title="WF Name" width="250" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWF_NM>
                        <span class="k-icon k-i-warning" style="width:200px; display:initial;"></span><span>
                            &nbsp;WF
                            Name is required
                        </span>
                    </ng-template>
                    <kendo-textbox [ngbTooltip]="tipWF_NM" tooltipClass="toolTipReq" placement="top" container="body"
                                   triggers="manual" #WF_NMTooltip="ngbTooltip" [autoClose]="outside"
                                   [formControl]="formGroup.get('WF_NM')"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="ROLE_TIER_NM" title="Role Tier" width="250" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipROLE_TIER_NM>
                        <span class="k-icon k-i-warning" style="width:200px; display:initial;"></span><span>
                            &nbsp;Role
                            Tier is required
                        </span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Role Tier'" #ROLE_TIER_NM_DdlTooltip="ngbTooltip"
                                    [data]="distinctRoleTierNm" [formControl]="formGroup.get('ROLE_TIER_NM')"
                                    [ngbTooltip]="tipROLE_TIER_NM" tooltipClass="toolTipReq" placement="top" container="body"
                                    triggers="manual" [autoClose]="false" [clearButton]="false" textField="Value" valueField="Key"
                                    [valuePrimitive]="true">
                    </kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="OBJ_TYPE" title="Obj Type" width="200" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipOBJ_TYPE>
                        <span class="k-icon k-i-warning" style="width:200px; display:initial;"></span><span>
                            &nbsp;Obj
                            Type is required
                        </span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Obj Type'" #OBJ_TYPE_DdlTooltip="ngbTooltip"
                                    [data]="distinctObjType" [formControl]="formGroup.get('OBJ_TYPE_SID')"
                                    [ngbTooltip]="tipOBJ_TYPE"
                                    tooltipClass="toolTipReq" placement="top" container="body" triggers="manual" [autoClose]="false"
                                    [clearButton]="false" textField="Value" valueField="Key" [valuePrimitive]="true">
                    </kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="OBJ_SET_TYPE_CD" title="Object Set Type" width="200"
                               [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <div *ngIf="!(formGroup.value.OBJ_TYPE_SID == '1' || formGroup.value.OBJ_TYPE_SID == '2' || formGroup.value.OBJ_TYPE_SID == '3')">
                        <kendo-combobox #ObjSetTypeCdDropDown [placeholder]="'Select Deal Type'"
                                        [data]="distinctObjSetTypeCd" [formControl]="formGroup.get('OBJ_SET_TYPE_SID')"
                                        [clearButton]="false" textField="Value" valueField="Key" [valuePrimitive]="true">
                        </kendo-combobox>
                    </div>
                    <div *ngIf="(formGroup.value.OBJ_TYPE_SID == '1' || formGroup.value.OBJ_TYPE_SID == '2' || formGroup.value.OBJ_TYPE_SID == '3')"
                         [ngClass]="{'disabledObjSetTypeDropdown': formGroup.value.OBJ_TYPE_SID.toString() == '1' || formGroup.value.OBJ_TYPE_SID.toString() == '2' || formGroup.value.OBJ_TYPE_SID.toString() == '3'}">
                        <kendo-combobox [placeholder]="'All_Deals'"
                                        [data]="distinctObjSetTypeCd"
                                        [clearButton]="false" textField="Value" valueField="Key" [valuePrimitive]="true">
                        </kendo-combobox>
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_ACTN_NM" title="Action" width="150" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_ACTN_NM>
                        <span class="k-icon k-i-warning" style="width:200px; display:initial;"></span><span>
                            &nbsp;Action
                            is required
                        </span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Action'" #WFSTG_ACTN_NM_DdlTooltip="ngbTooltip"
                                    [data]="distinctWFSTGActnNm" [formControl]="formGroup.get('WFSTG_ACTN_SID')"
                                    [ngbTooltip]="tipWFSTG_ACTN_NM" tooltipClass="toolTipReq" placement="top" container="body"
                                    triggers="manual" [autoClose]="false" [clearButton]="false" textField="Value" valueField="Key"
                                    [valuePrimitive]="true">
                    </kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_CD_SRC" width="150" title="Begin Stage"
                               [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_CD_SRC>
                        <span class="k-icon k-i-warning" style="width:200px; display:initial;"></span><span>
                            &nbsp;Source
                            is required
                        </span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Source'" #WFSTG_CD_SRC_DdlTooltip="ngbTooltip"
                                    [data]="distinctWFSTGCdSrc" [formControl]="formGroup.get('WFSTG_MBR_SID')"
                                    [ngbTooltip]="tipWFSTG_CD_SRC" tooltipClass="toolTipReq" placement="top" container="body"
                                    triggers="manual" [autoClose]="false" [clearButton]="false" textField="Value" valueField="Key"
                                    [valuePrimitive]="true">
                    </kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_CD_DEST" title="End Stage" width="150" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                                       [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_CD_DEST>
                        <span class="k-icon k-i-warning"
                              style="width:200px; display:initial;"></span><span>&nbsp;Destination is required</span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Destination'" #WFSTG_CD_DEST_DdlTooltip="ngbTooltip"
                                    [data]="distinctWFSTGCdDest" [formControl]="formGroup.get('WFSTG_DEST_MBR_SID')"
                                    [ngbTooltip]="tipWFSTG_CD_DEST" tooltipClass="toolTipReq" placement="top" container="body"
                                    triggers="manual" [autoClose]="false" [clearButton]="false" textField="Value" valueField="Key"
                                    [valuePrimitive]="true">
                    </kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="TRKR_NBR_UPD" width="150" title="Update Tracker" editor="boolean" filter="boolean"
                               [headerClass]="{'headerClass':true}">
                <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                    <div class="text-center">
                        <mat-slide-toggle class="toggle-button-custom" [color]="color" [checked]="dataItem.TRKR_NBR_UPD"
                                          disabled></mat-slide-toggle>
                    </div>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <div class="text-center">
                        <mat-slide-toggle class="toggle-button-custom" [color]="color" [checked]="dataItem.TRKR_NBR_UPD"
                                          [formControl]="formGroup.get('TRKR_NBR_UPD')"></mat-slide-toggle>
                    </div>
                </ng-template>
            </kendo-grid-column>
        </kendo-grid>
        <kendo-dialog *ngIf="isDialogVisible" class="workflow-delete-popup">
            <h3 class="kendo-dialog-message confirmationTitle">Delete confirmation</h3>
            <p class="kendo-dialog-message">{{errorMsg}}</p>
            <kendo-dialog-actions class="btns-workflow-valuer">
                <button class='k-button cancelBtn kendoDialogBtn' (click)="saveCancel()">Cancel</button>
                <button class='k-button deleteBtn kendoDialogBtn' (click)="deleteConfirmation()">Delete WorkFlow</button>
            </kendo-dialog-actions>
        </kendo-dialog>
    </div>
</div>