<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" />
<link href="/Client/src/app/admin/PrimeCustomers/admin.primeCustomers.component.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-12" style="padding-left: 30px; padding-top: 24px">
        <h3>Unified Customer Admin</h3>
    </div>
</div>
<div class="row">
    <div class="col-md-12 kendo-grid-buttons admin-table-header">
        <div class="excel-sections">
            <button class="btn btn-sm dropdown-toggle tool-hover" style="padding-right: .5rem;" type="button" data-toggle="dropdown">
                <div class="excel-btn-update">
                    <i class="intelicon-ms-excel-outlined" style="font-size: 30px;color: #fff"></i>
                    <span>Excel Export</span>
                    <span class="caret" style="color: #fff; width: 10px;"></span>
                </div>
            </button>
            <ul class="dropdown-menu" id="excelDropDownMenu">
                <li (click)="exportToExcel()" style="cursor: pointer;"><a>Export All Columns, All Data</a></li>
                <li (click)="exportToExcelCustomColumns()" style="cursor: pointer;"><a>Export Current View</a></li>
            </ul>
        </div>
        <kendo-grid class="KendoUnifiedCustomerInfo kAlignHeaders commandHeader" [data]="gridData" [loading]="isLoading" [pageSize]="state.take" [skip]="state.skip"
                    [sort]="state.sort" [filter]="state.filter" [sortable]="true"
                    [pageable]="{type:type,pageSizes: pageSizes,info:info}" [groupable]="false" [group]="state.group"
                    filterable="menu" [navigable]="true" (dataStateChange)="dataStateChange($event)" (add)="addHandler($event)"
                    (edit)="editHandler($event)" (cancel)="cancelHandler($event)" (save)="saveHandler($event)"
                    [columnMenu]="true" (excelExport)="onExcelExport($event)">
            <ng-template kendoGridToolbarTemplate>
                <button kendoGridAddCommand class="k-button addButton"
                        *ngIf="editAccess">
                    <span class="k-icon k-i-plus-outline k-icon-md"></span>Add New Record
                </button><button (click)="clearFilter()" class="k-button clearButton">
                    <span class="k-icon intelicon-cancel-filter-solid k-icon-md k-family"></span>Clear Filters
                </button>
                <kendo-grid-spacer></kendo-grid-spacer>
                <button (click)="refreshGrid()" class="k-button clearButton">
                    <span class="k-icon k-i-reload k-icon-md"></span>Refresh
                </button>
            </ng-template>
            <kendo-grid-command-column title="Commands" width="60" *ngIf="editAccess"
                                       [headerClass]="{'headerClass':true}" [columnMenu]="false">
                <ng-template kendoGridCellTemplate let-isNew="isNew">
                    <div class="text-center">
                        <button id="command-icon" class="k-command-icon" kendoGridEditCommand>
                            <span class="k-icon k-i-edit k-icon-sm edited-icon-color"></span>
                        </button>
                    </div>
                    <div class="text-center">
                        <button id="command-icon" class="k-command-icon" kendoGridSaveCommand>
                            <span class="k-icon k-i-check k-icon-sm"></span>
                        </button><button id="command-icon"
                                         class="k-command-icon" kendoGridCancelCommand>
                            <span class="k-icon k-i-cancel-outline k-icon-sm"></span>
                        </button>
                    </div>
                </ng-template>
            </kendo-grid-command-column>
            <kendo-grid-column field="IS_ACTV" title="Is Active" editor="boolean" width="50" filter="boolean"
                               [headerClass]="{'headerClass':true}">
                <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                    <div class="text-center">
                        <mat-slide-toggle class="toggle-button-custom" [color]="color" [checked]="dataItem.IS_ACTV" disabled></mat-slide-toggle>
                    </div>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <div class="text-center">
                        <mat-slide-toggle class="toggle-button-custom" [color]="color" [checked]="dataItem.IS_ACTV"
                                          [formControl]="formGroup.get('IS_ACTV')"></mat-slide-toggle>
                    </div>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_SID" title="Customer ID" [hidden]="true" width="70"
                               [headerClass]="{'headerClass':true}" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_CUST_ID" title="Unified Customer ID" width="100"
                               [headerClass]="{'headerClass':true}" [editable]="isUnifiedIdEditable">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-textbox #primeCustDropDown [formControl]="formGroup.get('PRIM_CUST_ID')"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_CUST_NM" title="Unified Customer Name" width="100"
                               [headerClass]="{'headerClass':true}" [editable]="isPrimCustNmEditable">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-combobox #primeCustNmDropDown [placeholder]="'Enter Customer Name..'" [virtual]="virtual"
                                    (open)="fieldLoad('PRIM_CUST_NM')" [data]="GetColumnFieldData('PRIM_CUST_NM')" [formControl]="formGroup.get('PRIM_CUST_NM')" [allowCustom]="allowCustom"></kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_LVL_ID" title="Country Customer ID" width="100"
                               [headerClass]="{'headerClass':true}" [editable]="isPrimLvlIdEditable">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter" let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-textbox #ctryCustDropDown [formControl]="formGroup.get('PRIM_LVL_ID')"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_LVL_NM" title="Country Customer Name" width="100"
                               [headerClass]="{'headerClass':true}" [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="PRIM_CUST_CTRY" title="Unified Country" width="100"
                               [headerClass]="{'headerClass':true}" [editable]="isPrimCustCtryEditable">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-combobox #primeCtryDropDown (open)="fieldLoad('PRIM_CUST_CTRY')" [data]="GetColumnFieldData('PRIM_CUST_CTRY')" [virtual]="virtual" 
                                    [formControl]="formGroup.get('PRIM_CUST_CTRY')" [allowCustom]="allowCustom"></kendo-combobox>
                </ng-template>
            </kendo-grid-column>

            <kendo-grid-column Current field="RPL_STS_CD" title="RPL Status Code" width="80"
                               [headerClass]="{'headerClass':true}" [editable]="isRplStsDdEditable">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                             let-filterService="filterService">
                    <kendo-grid-string-filter-menu [column]="column" [filter]="filter" [filterService]="filterService" [extra]="false">
                    </kendo-grid-string-filter-menu>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <kendo-multiselect id="rplStsCdDropDown" #rplStsCdDropDown  (open)="fieldLoad('RPL_STS_CD')" [data]="GetColumnFieldData('RPL_STS_CD')" [autoClose]="false"
                                       [formControl]="formGroup.get('RPL_STS_CD')" style="width: 170px;" class="rpl_statusMultiselect"></kendo-multiselect>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-excel fileName="MyDealsUnifiedCustomers.xlsx" [fetchData]="allData">
                <kendo-excelexport-column *ngFor="let item of excelColumns | keyvalue : returnZero" field="{{item.key}}"
                                          title="{{item.value}}" [width]="150" [cellOptions]="cellOptions"
                                          [headerCellOptions]="headerCellOptions"></kendo-excelexport-column>
            </kendo-grid-excel>
        </kendo-grid>
        <kendo-dialog *ngIf="isDialogVisible" (close)="saveCancel()" class="deactivatePopUp">
            <p class="kendo-dialog-message" style="white-space: pre-wrap; text-align: left; margin: 15px;">{{errorMessage}}</p>
            <kendo-dialog-actions class="ok_cncl_btn_fix">
                <button class='k-button ok_btn_fix' (click)="saveConfirmation()">OK</button>
                <button class='k-button cancel_btn_fix' *ngIf="cancelConfirm" (click)="saveCancel()">
                    CANCEL
                </button>
            </kendo-dialog-actions>
        </kendo-dialog>
    </div>
</div>