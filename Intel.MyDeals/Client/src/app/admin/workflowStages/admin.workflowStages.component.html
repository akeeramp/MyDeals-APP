﻿<link href="/Client/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="/Client/node_modules/@progress/kendo-theme-bootstrap/dist/all.css" rel="stylesheet" />
<link href="/Client/node_modules/@angular/material/prebuilt-themes/indigo-pink.css" rel="stylesheet" />
<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-12 k-header-alignment header-pos-fix">
        <h3>Work Flow Stage</h3>
    </div>
</div>
<div class="row">
    <div class="col-md-12 kendo-grid-buttons grid-lr-size">
        <kendo-grid [data]="gridData" [loading]="isLoading" [pageSize]="state.take" [skip]="state.skip"
            [sort]="state.sort" [filter]="state.filter" [sortable]="true"
            [pageable]="{type:type,pageSizes: pageSizes,info:info}" [groupable]="false" [group]="state.group"
            filterable="menu" [navigable]="true" (dataStateChange)="dataStateChange($event)" (add)="addHandler($event)"
            (edit)="editHandler($event)" (remove)="removeHandler($event)" (cancel)="cancelHandler($event)"
            (save)="saveHandler($event)" [columnMenu]="true" class="boxsize">
            <ng-template kendoGridToolbarTemplate>
                <!--Hiding DD functionality as its not working as expected, issues in DB-->
                <button kendoGridAddCommand class="k-button addButton">
                <span class="k-icon k-i-plus-outline k-icon-md"></span>ADD NEW RECORD
                </button><button (click)="clearFilter()" class="k-button clearButton"><span
                        class="k-icon intelicon-cancel-filter-solid k-icon-md k-family"></span>CLEAR FILTERS </button>
                <kendo-grid-spacer></kendo-grid-spacer>
                <button (click)="refreshGrid()" class="k-button clearButton"><span class="k-icon k-i-reload k-icon-md"></span>Refresh </button>
            </ng-template>
            <kendo-grid-command-column title="Commands" width="150" [headerClass]="{'headerClass':true}"
                [columnMenu]="false">
                <ng-template kendoGridCellTemplate let-isNew="isNew"><button id="command-icon" class="k-command-icon"
                        kendoGridEditCommand><span class="k-icon k-i-edit k-icon-sm remove-spacedelete"></span></button><button
                        id="command-icon" class="k-command-icon" kendoGridSaveCommand
                        [disabled]="formGroup?.invalid"><span class="k-icon k-i-check k-icon-sm"></span></button><button
                        id="command-icon" class="k-command-icon" kendoGridCancelCommand><span
                            class="k-icon k-i-cancel-outline k-icon-sm"></span></button>
                            <!--Hiding DELETE functionality as its not working as expected, issues in DB-->
                            <button id="command-icon" class="k-command-icon" kendoGridRemoveCommand><span
                            class="k-icon k-i-delete k-icon-sm"></span></button></ng-template>
            </kendo-grid-command-column>
            <kendo-grid-column field="WFSTG_MBR_SID" title="ID" width="100" [headerClass]="{'headerClass':true}"
                [editable]="false">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_NM" title="Stage Code" width="250" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_NM><span class="k-icon k-i-warning"
                            style="width:200px; display:initial;"></span><span>&nbsp;Stage Code is required</span>
                    </ng-template>
                    <kendo-textbox [ngbTooltip]="tipWFSTG_NM" tooltipClass="toolTipReq" placement="top" container="body"
                        triggers="manual" #WFSTG_NMTooltip="ngbTooltip" [autoClose]="outside"
                        [formControl]="formGroup.get('WFSTG_NM')"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_DESC" title="Stage Description" width="250"
                [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_DESC><span class="k-icon k-i-warning"
                            style="width:200px; display:initial;"></span><span>&nbsp;Stage Description is
                            required</span></ng-template>
                    <kendo-textbox [ngbTooltip]="tipWFSTG_DESC" tooltipClass="toolTipReq" placement="top"
                        container="body" triggers="manual" #WFSTG_DESCTooltip="ngbTooltip" [autoClose]="false"
                        [formControl]="formGroup.get('WFSTG_DESC')"></kendo-textbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="ROLE_TIER_NM" title="Role Tier" width="200" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipROLE_TIER_NM><span class="k-icon k-i-warning"
                            style="width:200px; display:initial;"></span><span>&nbsp;Role Tier is required</span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Role Tier'" #roleTierDdlTooltip="ngbTooltip"
                        [data]="distinctRoleTierNm" [formControl]="formGroup.get('ROLE_TIER_NM')"
                        [allowCustom]="allowCustom" [clearButton]="false" [ngbTooltip]="tipROLE_TIER_NM"
                        tooltipClass="toolTipReq" placement="top" container="body" triggers="manual"
                        [autoClose]="false"></kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_LOC" title="Location" width="200" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_LOC><span class="k-icon k-i-warning"
                            style="width:200px; display:initial;"></span><span>&nbsp;Location is required</span>
                    </ng-template>
                    <kendo-combobox [placeholder]="'Select Location'" #wfStgLocDdlTooltip="ngbTooltip"
                        [data]="distinctWfStgLoc" [formControl]="formGroup.get('WFSTG_LOC')" [allowCustom]="allowCustom"
                        [ngbTooltip]="tipWFSTG_LOC" tooltipClass="toolTipReq" placement="top" container="body"
                        triggers="manual" [autoClose]="false" [clearButton]="false"></kendo-combobox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="WFSTG_ORD" title="Order By" width="150" [headerClass]="{'headerClass':true}">
                <ng-template kendoGridFilterMenuTemplate let-column="column" let-filter="filter"
                    let-filterService="filterService">
                    <multicheck-filter [isPrimitive]="true" [field]="column.field" [currentFilter]="filter"
                        [filterService]="filterService" [data]="distinctPrimitive(column.field)"></multicheck-filter>
                </ng-template>
                <ng-template kendoGridCellTemplate let-dataItem="dataItem" let-rowIndex="rowIndex">
                    {{dataItem.WFSTG_ORD===1 ? "" : dataItem.WFSTG_ORD}} </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <ng-template #tipWFSTG_ORD><span class="k-icon k-i-warning"
                            style="width:200px; display:initial;"></span><span>&nbsp;Order By is required</span>
                    </ng-template>
                    <kendo-numerictextbox [formControl]="formGroup.get('WFSTG_ORD')" [min]="1"
                        [ngbTooltip]="tipWFSTG_ORD" tooltipClass="toolTipReq" placement="top" container="body"
                        triggers="manual" #WFSTG_ORDTooltip="ngbTooltip" [autoClose]="false"></kendo-numerictextbox>
                </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="ALLW_REDEAL" width="150" title="Allow Redeal" editor="boolean" filter="boolean"
                [headerClass]="{'headerClass':true}">
                <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                    <div class="text-center">
                        <mat-slide-toggle  class="toggle-button-custom" [color]="color" [checked]="dataItem.ALLW_REDEAL" disabled></mat-slide-toggle>
                    </div>
                </ng-template>
                <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                    <div class="text-center">
                        <mat-slide-toggle  class="toggle-button-custom" [color]="color" [checked]="dataItem.ALLW_REDEAL"
                            [formControl]="formGroup.get('ALLW_REDEAL')"></mat-slide-toggle>
                    </div>
                </ng-template>
            </kendo-grid-column>
        </kendo-grid>
        <kendo-dialog *ngIf="isDialogVisible" (close)="saveCancel()">
            <p class="kendo-dialog-message">{{errorMsg}}</p>
            <kendo-dialog-actions><button class='k-button' (click)="deleteConfirmation()">Delete
                    WorkFlow</button><button class='k-button' (click)="saveCancel()">Cancel</button>
            </kendo-dialog-actions>
        </kendo-dialog>
    </div>
</div>