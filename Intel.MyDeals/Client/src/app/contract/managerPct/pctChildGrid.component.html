<link href="/Client/src/app/contract/managerPct/managerPct.component.css" rel="stylesheet" />
<kendo-grid [data]="gridData" [loading]="isLoading" [pageSize]="5" [skip]="skip" [pageable]="true" scrollable="none"
    (pageChange)="pageChange($event)" [navigable]="true" kendoGridFocusable style="height:auto;" (cellClick)="cellClickHandler($event)">
    <kendo-grid-column [headerClass]="{'headerClass':true}" [width]="150"></kendo-grid-column>
    <kendo-grid-column title="PCT Result" field="PRC_CST_TST_STS" [headerClass]="{'headerClass':true}" [width]="120">
        <ng-template *ngIf="CAN_VIEW_COST_TEST" kendoGridCellTemplate let-dataItem>
            <icon-mct-pct-angular [dataValue]='dataItem.PRC_CST_TST_STS' [overrideValue]="dataItem.COST_TEST_OVRRD_FLG" [overrideFlgCmt]="dataItem.COST_TEST_OVRRD_CMT" [iconClass]="medIcon" >
            </icon-mct-pct-angular>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Deal Id" field="DEAL_ID" [headerClass]="{'headerClass':true}" [width]="100">
    </kendo-grid-column>
    <kendo-grid-column title="My Deals Product" field="PRODUCT" [headerClass]="{'headerClass':true}" [width]="170">
    </kendo-grid-column>
    <kendo-grid-column title="Processor #" field="PCSR_NBR" [headerClass]="{'headerClass':true}" [width]="170">
    </kendo-grid-column>
    <kendo-grid-column title="Deal Description" field="DEAL_DESC" [headerClass]="{'headerClass':true}" [width]="140">
    </kendo-grid-column>
    <kendo-grid-column title="Group Deals" field="GRP_DEALS" [headerClass]="{'headerClass':true}" [width]="140">
        <ng-template kendoGridCellTemplate let-dataItem>
            <span style="color: rgb(0, 113, 197); cursor: pointer; text-align: center;">View</span>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Deal Start/End" field="DEAL_STRT_DT" [headerClass]="{'headerClass':true}" [width]="180">
        <ng-template kendoGridCellTemplate let-dataItem>{{dataItem.DEAL_STRT_DT | date:
            'M/d/yyyy'}}-{{dataItem?.DEAL_END_DT | date: 'M/d/yyyy'}} </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Max RPU" field="MAX_RPU" [headerClass]="{'headerClass':true}" [width]="100"
        [hidden]="!hasPermissionPrice"></kendo-grid-column>
    <kendo-grid-column title="OEM Platform Launch Date" [width]="180" field="OEM_PLTFRM_LNCH_DT"
        [headerClass]="{'headerClass':true}" [hidden]="true">
        <ng-template kendoGridCellTemplate let-dataItem><span
                *ngIf="dataItem.OEM_PLTFRM_LNCH_DT!='1/1/1900'">{{dataItem.OEM_PLTFRM_LNCH_DT| date: 'M/d/yyyy'}}</span>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="OEM Platform EOL Date" [width]="180" field="OEM_PLTFRM_EOL_DT"
        [headerClass]="{'headerClass':true}" [hidden]="true">
        <ng-template kendoGridCellTemplate let-dataItem>{{dataItem.OEM_PLTFRM_EOL_DT | date: 'M/d/yyyy'}} </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Deal Stage" field="WF_STG_CD" [headerClass]="{'headerClass':true}" [width]="80"
        [hidden]="true"></kendo-grid-column>
    <kendo-grid-column title="CAP" field="CAP" [headerClass]="{'headerClass':true}" [width]="100"
        [hidden]="!hasPermissionPrice">
        <ng-template kendoGridCellTemplate let-dataItem>
             <span>
                 {{dataItem.CAP | currency}}
             </span>
         </ng-template></kendo-grid-column>
    <kendo-grid-column title="ECAP Price" field="ECAP_PRC" [headerClass]="{'headerClass':true}" [width]="120">
        <ng-template kendoGridCellTemplate let-dataItem>
            <span>
                {{dataItem.ECAP_PRC | currency}}
            </span>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="ECAP Floor" field="ECAP_FLR" [headerClass]="{'headerClass':true}" [width]="120"
        [hidden]="!hasPermissionPrice">
        <ng-template kendoGridCellTemplate let-dataItem>
            <span>
                {{dataItem.ECAP_FLR | currency}}
            </span>
        </ng-template></kendo-grid-column>
    <kendo-grid-column title="Lowest Net Price" field="LOW_NET_PRC" format="{0:c}" [headerClass]="{'headerClass':true}" [width]="140">
        <ng-template kendoGridCellTemplate let-dataItem>
           <div title="{{ dataItem?.LNP_FRMULA ? dataItem.LNP_FRMULA : ''}}">
            <span>
                {{dataItem.LOW_NET_PRC | currency}}
            </span>
           </div>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Cost" field="PRD_COST" [headerClass]="{'headerClass':true}" [width]="100"
        [hidden]="!hasPermissionPrice">
        <ng-template kendoGridCellTemplate let-dataItem>
            <span>
                {{dataItem.PRD_COST | currency}}
            </span>
        </ng-template></kendo-grid-column>
    <kendo-grid-column title="Cost Type" field="CST_TYPE" [headerClass]="{'headerClass':true}" [width]="120"
        [hidden]="!hasPermissionPrice"></kendo-grid-column>
    <kendo-grid-column title="Cost Test Analysis Override" field="COST_TEST_OVRRD_FLG"
        [headerClass]="{'headerClass':true}" [width]="150" [hidden]="hasNoPermissionOvr">
        <ng-template kendoGridCellTemplate let-dataItem="dataItem">
            <div style="text-align: center;">
              <span *ngIf="dataItem.PRC_CST_TST_STS === 'Pass' ||  dataItem.PRC_CST_TST_STS === 'NA'|| forceReadOnly === true || hasNoPermission === true" (change)="onOff(dataItem.COST_TEST_OVRRD_FLG)" style="vertical-align: -webkit-baseline-middle;">{{dataItem.COST_TEST_OVRRD_FLG}}</span>
              <span *ngIf="dataItem.PRC_CST_TST_STS !=='Pass' && dataItem.PRC_CST_TST_STS !== 'NA' && hasNoPermission !== true && forceReadOnly !== true">
                <label class="switch">
                    <input class="switch-input" type="checkbox" (change)="changeReasonFlg(dataItem)" [(ngModel)]="dataItem.COST_TEST_OVRRD_FLG" />
                    <span class="switch-label" data-on="Yes" data-off="No"></span> 
                    <span class="switch-handle"></span> 
                </label>
            </span>
            <div class="boxSave" [ngClass]="{'showReason': dataItem.saved, 'hideReason': !dataItem.saved}">SAVED</div>
            </div>
        </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Cost Test Analysis Override Comments" field="COST_TEST_OVRRD_CMT"
        [headerClass]="{'headerClass':true}" [width]="150" [hidden]="hasNoPermissionOvr">
        <ng-template kendoGridCellTemplate let-dataItem="dataItem">
        <button class="btn btn-sm btn-skyblue" *ngIf="dataItem.COST_TEST_OVRRD_FLG === 'Yes' || dataItem.COST_TEST_OVRRD_FLG === true" (click)="openReason(dataItem)" type="button" style="width: 120px;" title="Save and Validate"><span style="color:#FC4C02;">*</span> {{dataItem.COST_TEST_OVRRD_CMT === "" ? "Select" : "View Overrides"}}</button>
    </ng-template>
    </kendo-grid-column>
    <kendo-grid-column title="Retail Cycle" field="RTL_CYC_NM" [headerClass]="{'headerClass':true}" [width]="140"
        [hidden]="hasNoPermission"></kendo-grid-column>
    <kendo-grid-column title="Retail Pull $" field="RTL_PULL_DLR" [headerClass]="{'headerClass':true}" [width]="100"
        [hidden]="!hasSpecialPricePermission"></kendo-grid-column>
    <kendo-grid-column title="Market Segment" field="MKT_SEG" [headerClass]="{'headerClass':true}" [width]="140">
    </kendo-grid-column>
    <kendo-grid-column title="GEO" field="GEO" [headerClass]="{'headerClass':true}" [width]="140"></kendo-grid-column>
    <kendo-grid-column title="Payout Based On" field="PYOUT_BASE_ON" [headerClass]="{'headerClass':true}" [width]="140">
    </kendo-grid-column>
    <kendo-grid-column title="Consumption Reason" field="CNSMPTN_RSN" [headerClass]="{'headerClass':true}"
        [width]="160"></kendo-grid-column>
    <kendo-grid-column title="Program Payment" field="PROG_PMT" [headerClass]="{'headerClass':true}" [width]="150">
    </kendo-grid-column>
    <kendo-grid-column title="Deal Group Comments" field="DEAL_GRP_CMNT" [headerClass]="{'headerClass':true}"
        [width]="160"></kendo-grid-column>
    <kendo-grid-column title="Time / Date Last Cost Ran" field="LAST_COST_TEST_RUN" [headerClass]="{'headerClass':true}"
        [width]="180"></kendo-grid-column>
</kendo-grid>