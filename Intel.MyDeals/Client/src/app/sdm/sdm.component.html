<link href="/Client/src/app/admin/kendo_grid.css" rel="stylesheet" />
<loading-panel-angular [show]="isBusy" [header]="'Retail Pull Dollar...'" [isShowFunFact]="false" [description]="loaderMsg" [msgType]="'Info'" class="sdmLoading"></loading-panel-angular>
<div class="row">
    <div class="col-md-12" style="padding-left: 40px; padding-top: 10px">
        <h2 class="header-bottomsizereduce">Retail Pull Dollar Data Upload</h2>
    </div>
</div>
<div>
    <div style="display: flex;align-items: center; max-width: 100vw; margin-left: 1rem">
        <div class="col-md-14 sdmFilters">
            <div style="display: flex; padding: 0 .5rem 0 2rem; flex-direction: column;">
                <span class="fl" style="color: #222; font-size: 13px;">Cycle Name:</span>
                <div style="padding:.5rem">
                    <kendo-combobox [(ngModel)]="slctedData.CYCLE_NM" (filterChange)="getDropValues($event, 'CYCLE_NM')" [data]="filter['CYCLE_NM']" [filterable]="true" placeholder="Type to Search" style="width: 140px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                    </kendo-combobox>
                </div>
            </div>
            <div style="display: flex; padding: 0 .5rem 0 .5rem; flex-direction: column; ">
                <span class="fl" style="color: #222; font-size: 13px;">Category Name:</span>
                <div style="padding:.5rem">
                    <kendo-combobox [(ngModel)]="slctedData.CPU_VRT_NM" (filterChange)="getDropValues($event, 'CPU_VRT_NM')" [data]="filter['CPU_VRT_NM']" [filterable]="true" placeholder="Type to Search" style="width: 140px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                    </kendo-combobox>
                </div>
            </div>
            <div style="display: flex; padding: 0 .5rem 0 .5rem; flex-direction: column; ">
                <span class="fl" style="color: #222; font-size: 13px;">Processor Number:</span>
                <div style="padding:.5rem">
                    <kendo-combobox [(ngModel)]="slctedData.CPU_PROCESSOR_NUMBER" (filterChange)="getDropValues($event, 'CPU_PROCESSOR_NUMBER')" [data]="filter['CPU_PROCESSOR_NUMBER']" [filterable]="true" placeholder="Type to Search" style="width: 140px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                    </kendo-combobox>
                </div>
            </div>
            <div style="display: flex; padding: 0 .5rem 0 .5rem; flex-direction: column; ">
                <span class="fl" style="color: #222; font-size: 13px;">SKU Name:</span>
                <div style="padding:.5rem">
                    <kendo-combobox [(ngModel)]="slctedData.CPU_SKU_NM" (filterChange)="getDropValues($event, 'CPU_SKU_NM')" [data]="filter['CPU_SKU_NM']" [filterable]="true" placeholder="Type to Search" style="width: 140px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                    </kendo-combobox>
                </div>
            </div>
            <div style="display: flex; padding: 0 .5rem 0 .5rem; flex-direction: column; ">
                <span class="fl" style="color: #222; font-size: 13px;">Date Range:</span>
                <div style="display: flex; flex-direction: row; padding: .5rem">
                    <div style="display: flex; padding: 0 .5rem 0 0; flex-direction: row;">
                        <kendo-datepicker [(value)]="slctedData.STRT_DT" [weekNumber]="true" calendarType="classic" placeholder="Uploaded From" style="width: 156px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                        </kendo-datepicker>
                    </div>
                    <span style="display: flex; align-items: center;">to</span>
                    <div style="padding: 0 0 0 .5rem;">
                        <kendo-datepicker [(value)]="slctedData.END_DT" [weekNumber]="true" calendarType="classic" placeholder="Uploaded Till" style="width: 156px; float: left; height: 35px; font-size: 11px;" class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                        </kendo-datepicker>
                    </div>
                </div>
            </div>
            <div style="display: flex; padding: 0 .5rem 0 .5rem; flex-direction: column; align-content: center; justify-content: center; ">
                <button class="btn btn-primary optsdm opUiContainer md" (click)="filterSdmGrid()" type="button" style="margin-left: 20px; font-size: 14px;">
                    Apply Filter
                </button>
            </div>
        </div>
        <div style="float: right; width: 15vw; display: flex; flex-direction: row-reverse;">
            <div style="margin: 2rem; color: #aaaaaa; ">
                <button class="btn btn-primary optsdm opUiContainer md" (click)="redirectToSdmBulkUpload()" style="float: right; font-size: 14px; ">Upload RPD</button>
            </div>
        </div>
    </div>    

    <div class="row sdmMasteDataLookup">
        <div>
            <a style="cursor: pointer;" class="text-dwnlod-style-admin" (click)="openMasterDataModal()">Click here for master data lookup</a>
        </div>
    </div>

    <div class="row" style="display: contents;">
        <div class="col-md-12 kendo-grid-buttons table-left-rightsizefix sdmgridsall" style="padding-top: 15px !important;">
            <kendo-grid #grid class="pro-sdm kAlignHeaders" style="height: calc(90vh - 240px) !important;" [data]="gridData" [pageSize]="state.take" [skip]="state.skip" [sortable]="true" (dataStateChange)="dataStateChange($event)" (remove)="removeHandler($event)" [pageable]="{type:type,pageSizes: pageSizes,info:info}"
                        (edit)="editHandler($event)" (add)="addHandler($event)" (cancel)="cancelHandler($event)" (save)="saveHandler($event)" [navigable]="true" [sort]="state.sort">
                <ng-template kendoGridToolbarTemplate>
                    <button kendoGridAddCommand class="k-button addButton">
                        <span class="k-icon k-i-plus-outline k-icon-md"></span>Add New Record
                    </button>
                    <kendo-grid-spacer></kendo-grid-spacer>
                    <kendo-menu (select)="excelSelection($event)" class="rpd-excel-export-menu">
                        <kendo-menu-item text="Excel Export">
                            <kendo-menu-item text="Export Current View"></kendo-menu-item>
                            <kendo-menu-item kendoGridExcelCommand text="Export All Data, Complete Records"></kendo-menu-item>
                        </kendo-menu-item>
                    </kendo-menu>
                    <button (click)="clearFilter()" class="k-button clearButton">
                        <span class="k-icon intelicon-cancel-filter-solid k-icon-md k-family"></span>Clear Filters
                    </button>
                    <button class="k-button clearButton" (click)="refreshGrid()">
                        <span class="k-icon k-i-reload k-icon-md"></span>Refresh
                    </button>
                </ng-template>
                <kendo-grid-command-column title="" width="150px" [headerClass]="{'headerClass':true}" [columnMenu]="false">
                    <ng-template kendoGridCellTemplate let-isNew="isNew">
                        <button id="command-icon" class="k-command-icon" kendoGridEditCommand>
                            <span class="k-icon k-i-edit k-icon-sm delete-space edited-icon-color delete-editorspaceremove"></span>
                        </button>
                        <button id="command-icon" class="k-command-icon" kendoGridSaveCommand [disabled]="formGroup?.invalid">
                            <span class="k-icon k-i-check k-icon-sm"></span>
                        </button>
                        <button id="command-icon" class="k-command-icon remove-focus-hightlight" kendoGridCancelCommand>
                            <span class="k-icon k-i-cancel-outline k-icon-sm remove-space-cancel remove-canceloutline"></span>
                        </button>
                        <button id="command-icon" class="k-command-icon" kendoGridRemoveCommand>
                            <span class="k-icon k-i-delete k-icon-sm edited-icon-color"></span>
                        </button>
                    </ng-template>
                </kendo-grid-command-column>
                <kendo-grid-column field="CYCLE_NM" title="Cycle Name" width="200px" [headerClass]="{'headerClass':true}">
                </kendo-grid-column>

                <kendo-grid-column field="CURR_STRT_DT" title="Start Date" width="200px" [headerClass]="{'headerClass':true}">
                    <ng-template kendoGridEditTemplate let-dataItem="dataItem" kendoTooltip let-formGroup="formGroup">
                        <kendo-datepicker [formControl]="formGroup.get('CURR_STRT_DT')" [weekNumber]="true" calendarType="classic"
                                          title= "{{formGroup.controls['CURR_STRT_DT'].errors ? formGroup.controls['CURR_STRT_DT'].errors.val : 'Choose a date'}}" placeholder="Choose date ...">
                        </kendo-datepicker>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CURR_END_DT" title="End Date" width="200px" [headerClass]="{'headerClass':true}">
                    <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                        <kendo-datepicker [formControl]="formGroup.get('CURR_END_DT')" [weekNumber]="true" calendarType="classic"
                                           title = "{{formGroup.controls['CURR_END_DT'].errors ? formGroup.controls['CURR_END_DT'].errors.val : 'Choose a date'}}" placeholder="Choose date ...">                            
                        </kendo-datepicker>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CPU_VRT_NM" title="Category Name" width="200px" [headerClass]="{'headerClass':true}">
                    <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                        <kendo-combobox [formControl]="formGroup.get('CPU_VRT_NM')" (filterChange)="getDropValues($event, 'PRD_CAT_NM')" [data]="filter['PRD_CAT_NM']" [filterable]="true" placeholder="Type to Search" style="width: 180px; float: left; height: 35px; font-size: 11px;"
                                        class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                        </kendo-combobox>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CPU_PROCESSOR_NUMBER" title="Processor Number" width="200px" [headerClass]="{'headerClass':true}">
                    <ng-template kendoGridEditTemplate let-dataItem="CPU_PROCESSOR_NUMBER" let-formGroup="formGroup">
                        <kendo-combobox [formControl]="formGroup.get('CPU_PROCESSOR_NUMBER')" (filterChange)="getDropValues($event, 'PCSR_NBR')" [data]="filter['PCSR_NBR']" [filterable]="true" placeholder="Type to Search" style="width: 180px; float: left; height: 35px; font-size: 11px;"
                                        class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                        </kendo-combobox>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CPU_SKU_NM" title="SKU Name" width="200px" [headerClass]="{'headerClass':true}">
                    <ng-template kendoGridEditTemplate let-dataItem="CPU_SKU_NM" let-formGroup="formGroup">
                        <kendo-combobox [formControl]="formGroup.get('CPU_SKU_NM')" (filterChange)="getDropValues($event, 'SKU_NM')" [data]="filter['SKU_NM']" [filterable]="true" placeholder="Type to Search" style="width: 180px; float: left; height: 35px; font-size: 11px;"
                                        class="optsdm opUiContainer md no-dropdown-arrow-rpd">
                        </kendo-combobox>
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CPU_FLR" title="CPU_FLR" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-dataItem="dataItem" let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('CPU_FLR')" />
                    </ng-template>
                </kendo-grid-column>

                <kendo-grid-column field="APAC_PD" title="APAC_PD" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('APAC_PD')" />
                    </ng-template>
                </kendo-grid-column>

                <kendo-grid-column field="IJKK_PD" title="IJKK_PD" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('IJKK_PD')" />
                    </ng-template>
                </kendo-grid-column>

                <kendo-grid-column field="PRC_PD" title="PRC_PD" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('PRC_PD')" />
                    </ng-template>
                </kendo-grid-column>

                <kendo-grid-column field="EMEA_PD" title="EMEA_PD" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('EMEA_PD')" />
                    </ng-template>
                </kendo-grid-column>

                <kendo-grid-column field="ASMO_PD" title="ASMO_PD" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                    <ng-template kendoGridEditTemplate let-formGroup="formGroup">
                        <input type="number" class="k-textbox" [formControl]="formGroup.get('ASMO_PD')" />
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="CHG_DTM" title="Last Modified Date" width="200px" [headerClass]="{'headerClass':true}" [sortable]="false">
                </kendo-grid-column>
            </kendo-grid>
            <kendo-dialog class="deleted-popups" *ngIf="isDialogVisible" (close)="close()" [width]="600">
                <h2>Delete Confirmation</h2>
                <p style="padding-top: 15px;">
                    You are about to delete data from Retail Pull Dollar Stage Table, please confirm to proceed.
                </p>
                <kendo-dialog-actions class="delete-actions">
                    <button class="k-button del-cancel" kendoButton (click)="close()">Cancel</button>
                    <button class="k-button del-ok" kendoButton (click)="deleteRecord()">Delete</button>
                </kendo-dialog-actions>
            </kendo-dialog>

            <kendo-dialog class="rpd-excel-popups" *ngIf="isExportAllDialogVisible" id="rpd-kendo-excel-popup">
                <h2 style="padding:10px;">Excel Export Confirmation</h2>
                <p style="padding:15px;">You are exporting a rather large amount of data ({{totalRecs}} rows). Would you like to continue?</p>
                <kendo-dialog-actions class="rpd-excel-actions">
                    <button kendoButton class="k-button rpd-excel-cancel" (click)="closeExcelDialog()">Cancel</button>
                    <button kendoButton class="k-button rpd-excel-ok" (click)="downloadAllExcelRecords()">Ok</button>
                </kendo-dialog-actions>
            </kendo-dialog>
        </div>
    </div>
</div>
